<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enrollment Form - Nymph Academy</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <style>
        body { background-color: #f8f9fa; font-family: 'Arial', sans-serif; }
        .header { background-color: #007bff; color: white; padding: 20px; text-align: center; }
        .header img { max-height: 80px; margin-bottom: 10px; }
        .form-container { max-width: 600px; margin: 20px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .payment-section { display: none; background: #e7f3ff; padding: 15px; border-radius: 5px; margin-top: 20px; }
        label { font-weight: bold; }
        button { width: 100%; margin-top: 10px; }
        #imagePreview { max-width: 200px; max-height: 200px; margin-top: 10px; border: 1px solid #ddd; border-radius: 5px; }
        footer { background-color: #343a40; color: white; padding: 20px 0; margin-top: 40px; }
        .footer-content { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .footer-links a { color: #adb5bd; text-decoration: none; margin: 0 10px; }
        .footer-links a:hover { color: white; }
        .social-icons a { font-size: 1.5em; margin: 0 10px; color: #adb5bd; }
        .social-icons a:hover { color: white; }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://www.nymphacademy.in/logo.png" alt="Nymph Academy Logo" onerror="this.src='https://via.placeholder.com/200x80/007bff/ffffff?text=Nymph+Academy';">
        <h1>Welcome to Nymph Academy</h1>
        <p>Enroll today for ₹150 fee. Secure and easy process.</p>
    </div>

    <div class="container">
        <div class="form-container">
            <h2 class="text-center">Enrollment Form</h2>
            <form id="enrollmentForm" enctype="multipart/form-data">
                <!-- Name Field -->
                <div class="mb-3">
                    <label for="name" class="form-label">Full Name *</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>

                <!-- Phone Number Field -->
                <div class="mb-3">
                    <label for="phone" class="form-label">Phone Number *</label>
                    <input type="tel" class="form-control" id="phone" name="phone" pattern="[0-9]{10}" required>
                </div>

                <!-- Gender Field -->
                <div class="mb-3">
                    <label for="gender" class="form-label">Gender *</label>
                    <select class="form-select" id="gender" name="gender" required>
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <!-- Class Field -->
                <div class="mb-3">
                    <label for="class" class="form-label">Class/Grade *</label>
                    <select class="form-select" id="class" name="class" required>
                        <option value="">Select Class</option>
                        <option value="1">Class 1</option>
                        <option value="2">Class 2</option>
                        <option value="3">Class 3</option>
                        <option value="4">Class 4</option>
                        <option value="5">Class 5</option>
                        <option value="6">Class 6</option>
                        <option value="7">Class 7</option>
                        <option value="8">Class 8</option>
                        <option value="9">Class 9</option>
                        <option value="10">Class 10</option>
                        <option value="11">Class 11</option>                        
                        <option value="12">Class 12</option>
                    </select>
                </div>

                <!-- Email Field (Required for Confirmation) -->
                <div class="mb-3">
                    <label for="email" class="form-label">Email *</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>

                <!-- Address Field -->
                <div class="mb-3">
                    <label for="address" class="form-label">Address (Optional)</label>
                    <textarea class="form-control" id="address" name="address" rows="3"></textarea>
                </div>

                <!-- Student Image Upload -->
                <div class="mb-3">
                    <label for="studentImage" class="form-label">Student Photo * (JPG/PNG, max 5MB)</label>
                    <input type="file" class="form-control" id="studentImage" name="studentImage" accept="image/jpeg,image/png" required>
                    <img id="imagePreview" src="" alt="Preview" style="display: none;">
                    <div class="form-text">Upload a clear photo of the student.</div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary">Proceed to Payment (₹150)</button>
            </form>

            <!-- Payment Section -->
            <div id="paymentSection" class="payment-section">
                <h4>Payment Details</h4>
                <p>Amount: ₹150 (One-time enrollment fee)</p>
                <button id="payButton" class="btn btn-success mt-2">Pay Now</button>
                <div id="paymentStatus"></div>
            </div>
        </div>
    </div>

    <!-- Footer (Same as Before) -->
    <footer>
        <div class="footer-content">
            <div class="row">
                <div class="col-md-4">
                    <h5>Nymph Academy</h5>
                    <p>Empowering young minds through quality education. Located in [Your City, India].</p>
                    <p><i class="fas fa-phone"></i> +91-XXXXXXXXXX | <i class="fas fa-envelope"></i> info@nymphacademy.in</p>
                    <p><i class="fas fa-map-marker-alt"></i> [Your Address]</p>
                </div>
                <div class="col-md-4">
                    <h5>Quick Links</h5>
                    <div class="footer-links">
                        <a href="/">Home</a>
                        <a href="/about">About Us</a>
                        <a href="/courses">Courses</a>
                        <a href="/contact">Contact</a>
                        <a href="/privacy">Privacy Policy</a>
                    </div>
                </div>
                <div class="col-md-4">
                    <h5>Follow Us</h5>
                    <div class="social-icons">
                        <a href="https://facebook.com/nymphacademy" target="_blank"><i class="fab fa-facebook"></i></a>
                        <a href="https://instagram.com/nymphacademy" target="_blank"><i class="fab fa-instagram"></i></a>
                        <a href="https://twitter.com/nymphacademy" target="_blank"><i class="fab fa-twitter"></i></a>
                    </div>
                    <p class="mt-3">© 2023 Nymph Academy. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Razorpay JS -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <!-- Custom JS -->
    <script>
        const form = document.getElementById('enrollmentForm');
        const paymentSection = document.getElementById('paymentSection');
        const payButton = document.getElementById('payButton');
        const paymentStatus = document.getElementById('paymentStatus');
        const imageInput = document.getElementById('studentImage');
        const imagePreview = document.getElementById('imagePreview');

        // Image Preview and Validation
        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    alert('File too large! Max 5MB.');
                    e.target.value = '';
                    return;
                }
                if (!file.type.startsWith('image/')) {
                    alert('Please upload an image file.');
                    e.target.value = '';
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // Form Submission: Send to Backend, Then Payment
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            if (!form.checkValidity() || !imageInput.files[0]) {
                alert('Please fill all required fields and upload an image.');
                return;
            }

            const formData = new FormData(form);
            try {
                // Send form data (including image) to backend for temp storage/prep
                const response = await fetch('/submit-form', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                if (result.success) {
                    // Store order ID from backend for payment
                    window.orderId = result.orderId;
                    paymentSection.style.display = 'block';
                    form.style.display = 'none';
                } else {
                    alert('Error: ' + result.message);
                }
            } catch (err) {
                alert('Submission failed. Please try again.');
            }
        });

        // Razorpay Payment
        payButton.addEventListener('click', function() {
            const options = {
                key: 'rzp_test_YOUR_KEY_HERE', // Replace with your key
                amount: 15000, // ₹150 in paise
                currency: 'INR',
                order_id: window.orderId, // From backend
                name: 'Nymph Academy',
                description: 'Enrollment Fee',
                prefill: {
                    name: document.getElementById('name').value,
                    contact: document.getElementById('phone').value,
                    email: document.getElementById('email').value
                },
                handler: function(response) {
                    // Verify payment on backend
                    fetch('/verify-payment', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ paymentId: response.razorpay_payment_id, orderId: window.orderId })
                    }).then(res => res.json()).then(data => {
                        if (data.success) {
                            paymentStatus.innerHTML = '<div class="alert alert-success">Success! Check your email for confirmation (Roll No: ' + data.rollNumber + ').</div>';
                            alert('Enrollment confirmed!');
                        } else {
                            paymentStatus.innerHTML = '<div class="alert alert-danger">Payment verification failed.</div>';
                        }
                    });
                },
                theme: { color: '#007bff' }
            };
            const rzp = new Razorpay(options);
            rzp.open();
        });
    </script>
</body>
</html>

